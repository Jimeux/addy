<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="robots" content="noindex"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript"
          src="https://checkoutshopper-test.adyen.com/checkoutshopper/assets/js/sdk/checkoutSDK.1.6.4.min.js"></script>
</head>
<body>

<!--paymentSessionの値をここに入れる-->
<input id="session" type="hidden" value="{{ .session }}"/>
<div style="max-width: 500px; margin: 90px auto">
  <div>
    <strong>Visa</strong><br>
    4988 4388 4388 4305 <br>
    10/20 <br>
    737
    <hr>
  </div>
  <div>
    <strong>3D MasterCard</strong><br>
    5212 3456 7890 1234<br>
    10/20 <br>
    737 <br>
    user <br>
    password
  </div>
  <br><br>

  <!--ペイメントフォームをここに入れる-->
  <div id="form-container"></div>

</div>

<script type="text/javascript">
  const configurationObject = {
    autoFocusOnLoad: true,
    consolidateCards: true,
    context: 'test',
    initialPMCount: 5, // Overwrites the initial amount of payment methods shown
    //translations: translationObject,
    //allowAddedLocales: false, // Allows you to add a locale
    paymentMethods: {
      card: {
        //sfStyles: securedFieldsStyles,
        separateDateInputs: false,
        placeholders: {
          encryptedSecurityCode: '1111',
          encryptedExpiryDate: '02/12'
        }
      }
    }
  }

  $(document).ready(() => {
    const session = $("#session").val()
    // init
    chckt.checkout(session, '#form-container', configurationObject)
    // フォームのサブミットのリクエストが返ってくる時に呼び出される
    chckt.hooks.beforeComplete = (node, paymentData) => {
      // Object.keys(paymentData) = ["url", "payload", "resultCode", "resultText"]
      console.log(paymentData);

      const payloadObject = {
        payload: paymentData.payload
      }

      $.ajax({
        url: '/result',
        data: payloadObject,
        method: 'POST',
        /*success: (data) => { // カスタム対応
          $("#form-container").html("SUCCESS 🤩👍!!!!!!")
        },*/
        error: () => {
          console.log("error")
          console.log('### adyenCheckout::error:: args=', arguments)
        }
      })
      return true
    }
  })
</script>

</body>
</html>
